<h4>{{ translateKeyPrefix + "HEADLINE" | translate }}</h4>
<br />
<p>{{ translateKeyPrefix + "SUBTITLE" | translate }}</p>

<hr />
<br />
<sxm-ui-subscription-summary-block *ngIf="subscription" [subscription]="subscription"></sxm-ui-subscription-summary-block>

<br />

<hr />

<br />
<h5>{{ translateKeyPrefix + "SUB_HEADLINE" | translate }}</h5>

<div [innerHTML]="translateKeyPrefix + 'INSTRUCTIONS' | translate"></div>

<form [formGroup]="credentialsFormGroup" novalidate>
    <div *ngIf="isSystemError$ | async" class="invalid-feedback">
        <p>{{ translateKeyPrefix + "SYSTEM_ERROR" | translate }}</p>
    </div>

    <div class="row no-padding">
        <div class="column small-12 no-padding align-left">
            <sxm-ui-text-form-field
                formControlName="username"
                [labelText]="translateKeyPrefix + 'USERNAME.LABEL' | translate"
                [errorMsg]="translateKeyPrefix + 'USERNAME.ERRORS.REQUIRED' | translate"
                data-e2e="username"
                *ngIf="!usernameIsReadonly && formFieldsToShow.username"
            >
            </sxm-ui-text-form-field>
            <sxm-ui-text-form-field
                formControlName="email"
                [labelText]="translateKeyPrefix + 'EMAIL.LABEL' | translate"
                [errorMsg]="translateKeyPrefix + 'EMAIL.ERRORS.REQUIRED' | translate"
                data-e2e="email"
                *ngIf="!usernameIsReadonly && formFieldsToShow.email"
            >
            </sxm-ui-text-form-field>
            <p *ngIf="usernameIsReadonly">
                <strong>{{ readonlyEmail }}</strong>
            </p>

            <div *ngIf="isUserNameExist$ | async" class="invalid-feedback">
                <p>
                    {{ translateKeyPrefix + "USERNAME.ERRORS.ALREADY_EXIST" | translate }}
                    <a target="_blank" style="color: #eb0a0a" sxmUiDataClickTrack="player" (click)="onSignIn()">{{ translateKeyPrefix + "LINK_TEXT" | translate }}</a>
                </p>
            </div>
        </div>
    </div>
    <br />

    <sxm-ui-password-strength
        formControlName="password"
        [labelText]="translateKeyPrefix + 'PASSWORD.LABEL' | translate"
        id="{{ passwordElementId }}"
        [reservedWords]="reservedWords"
        [alwaysDisplayPasswordHint]="alwaysDisplayPasswordHint"
        [class.invalid]="credentialsFormGroup.controls.password | formControlInvalid: submitted"
        #passwordControl
    >
    </sxm-ui-password-strength>

    <div *ngIf="credentialsFormGroup.controls.password | formControlInvalid: submitted" class="invalid-feedback">
        <p *ngIf="credentialsFormGroup.controls.password.hasError('required')">
            {{ translateKeyPrefix + "PASSWORD.ERRORS.REQUIRED" | translate }}
        </p>
        <p *ngIf="credentialsFormGroup.controls.password.hasError('length')">
            {{ translateKeyPrefix + "PASSWORD.ERRORS.GENERIC" | translate: credentialsFormGroup.controls.password.errors.length }}
        </p>
        <p *ngIf="credentialsFormGroup.controls.password.hasError('policy')">
            {{ translateKeyPrefix + "PASSWORD.ERRORS.GENERIC" | translate }}
        </p>
        <p *ngIf="credentialsFormGroup.controls.password.hasError('generic')">
            {{ translateKeyPrefix + "PASSWORD.ERRORS.GENERIC" | translate }}
        </p>
        <p *ngIf="credentialsFormGroup.controls.password.errors?.reservedWords as reservedWordsError">
            {{
                translateKeyPrefix + "PASSWORD.ERRORS.RESERVED_WORDS"
                    | translate
                        : {
                              pluralWord: reservedWordsError.words.length | i18nPlural: (translateKeyPrefix + "PLURAL_MAP.WORD" | translate),
                              reservedWords: reservedWordsError.words.join(", ")
                          }
            }}
        </p>
    </div>
    <div *ngIf="isInvalidPasswordError$ | async" class="invalid-feedback">
        <p>{{ translateKeyPrefix + "PASSWORD.ERRORS.GENERIC" | translate }}</p>
    </div>
    <div *ngIf="isPasswordContainsPiiDataError$ | async" class="invalid-feedback">
        <p>{{ translateKeyPrefix + "PASSWORD.ERRORS.PII_DATA" | translate }}</p>
    </div>
    <ng-content select="[privacyPolicy]"></ng-content>

    <button
        [loading]="loading$ | async"
        type="button"
        (click)="onSubmitClick()"
        sxm-proceed-button
        sxmUiDataClickTrack="submit"
        data-e2e="CreateCredentialsFormSubmitButton"
        (mouseenter)="mouseEnterOnContinueButton()"
        (mouseleave)="mouseLeaveOnContinueButton()"
    >
        {{ translateKeyPrefix + "CONTINUE_BUTTON_TEXT" | translate }}
    </button>
</form>

<!-----------------UpdateEmailModal----------------->
<sxm-ui-modal #UpdateEmailModal (modalClosed)="onModalClosed()" [title]="translateKeyPrefix + 'CONFIRM_EMAIL_UPDATE_MODAL_HEADER' | translate" [titlePresent]="true">
    <h5>{{ translateKeyPrefix + "CONFIRM_EMAIL_UPDATE_MODAL_TITLE" | translate }}</h5>
    <div [innerHTML]="translateKeyPrefix + 'CONFIRM_EMAIL_UPDATE_MODAL_SUBTITLE' | translate"></div>
    <br />
    <hr />
    <br />
    <div class="text_color">{{ translateKeyPrefix + "CONFIRM_EMAIL_UPDATE_MODAL_FROM_EMAIL" | translate }}</div>
    <br />
    <div>
        <strong>{{ subscription.email }}</strong>
    </div>
    <br />
    <div class="text_color">{{ translateKeyPrefix + "CONFIRM_EMAIL_UPDATE_MODAL_TO_EMAIL" | translate }}</div>
    <br />
    <div>
        <strong>{{ emailToPrefill }}</strong>
    </div>
    <br />
    <p>{{ translateKeyPrefix + "EMAIL_UPDATE_MSG" | translate }}</p>
    <button type="submit" sxm-proceed-button sxmUiDataClickTrack="submit" (click)="openEmailUpdateModal()">
        {{ translateKeyPrefix + "CONFIRM_EMAIL_UPDATE_MODAL_BUTTON_TEXT" | translate }}
    </button>
    <br />
    <div class="text-center text_spacing">
        <a (click)="closeModal()" sxmUiDataClickTrack="submit"
            ><strong>{{ translateKeyPrefix + "CONFIRM_EMAIL_UPDATE_MODAL_LINK_TEXT" | translate }}</strong></a
        >
    </div>
</sxm-ui-modal>

<!-----------------ConfirmUpdateEmailModal----------------->
<sxm-ui-modal #SubscribeEmailModal (modalClosed)="onModalClosed()" [title]="translateKeyPrefix + 'CONFIRM_EMAIL_UPDATE_MODAL_HEADER' | translate" [titlePresent]="true">
    <h5>{{ translateKeyPrefix + "CONFIRM_EMAIL_UPDATE_MODAL_TITLE" | translate }}</h5>
    <div [innerHTML]="translateKeyPrefix + 'EMAIL_UPDATE_MODAL_SUBTITLE' | translate"></div>
    <br />
    <hr />
    <br />
    <div>
        <strong>{{ emailToPrefill }}</strong>
    </div>
    <button type="submit" sxm-proceed-button sxmUiDataClickTrack="submit" (click)="goToConfirmationPage()">
        {{ translateKeyPrefix + "EMAIL_UPDATE_MODAL_BUTTON_TEXT" | translate }}
    </button>
    <br />
    <div class="text-center">
        <a (click)="closeConfirmationModal()" sxmUiDataClickTrack="submit"
            ><strong>{{ translateKeyPrefix + "EMAIL_UPDATE_MODAL_LINK_TEXT" | translate }}</strong></a
        >
    </div>
</sxm-ui-modal>
