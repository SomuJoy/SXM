<div class="grid-container" [ngClass]="['grid-columns-' + numPlans]" *ngIf="parameters$ | async as parameters" data-test="planGrid">
    <ng-container *ngIf="promoPriceRowColumnsData">
        <ng-container
            *ngTemplateOutlet="
                gridRowTemplate;
                context: {
                    title: translateKeyPrefix + '.PROMO_TEXT' | translate: { termLength: 12 },
                    subTitle: translateKeyPrefix + '.PROMO_SUB_TEXT' | translate,
                    columns: promoPriceRowColumnsData
                }
            "
        ></ng-container>
    </ng-container>
    <ng-container *ngIf="whatYouGetRowColumnsData">
        <ng-container
            *ngTemplateOutlet="gridRowTemplate; context: { title: translateKeyPrefix + '.WHAT_YOU_GET' | translate, columns: whatYouGetRowColumnsData }"
        ></ng-container>
    </ng-container>
    <sxm-ui-accordion-chevron
        [collapsedText]="translateKeyPrefix + '.COLLAPSED_TEXT' | translate"
        [expandedText]="translateKeyPrefix + '.EXPANDED_TEXT' | translate"
        [opened]="!activateExpandable"
        [ngClass]="{ 'hidden-chevron': !activateExpandable }"
        class="within-grid accordion-chevron"
    >
        <ng-container *ngIf="hasWhereToListenRow">
            <div class="grid-container grid-accordion-container" [ngClass]="['grid-columns-' + numPlans]">
                <ng-container
                    *ngTemplateOutlet="gridRowTemplate; context: { title: translateKeyPrefix + '.WHERE_TO_LISTEN' | translate, columns: whereToListenColumns }"
                ></ng-container>
            </div>
        </ng-container>
        <div class="grid-container grid-accordion-container" [ngClass]="['grid-columns-' + numPlans]">
            <ng-container data-e2e="planComparisonFeatureContainer" *ngFor="let feature of parameters?.features?.slice(hasWhereToListenRow ? 0 : 1); let i = index">
                <ng-container *ngTemplateOutlet="gridRowTemplate; context: { title: feature?.name, columns: feature?.columns }"></ng-container>
            </ng-container>
        </div>

        <div class="grid-container grid-accordion-container" [ngClass]="['grid-columns-' + numPlans]">
            <ng-container
                *ngTemplateOutlet="
                    gridRowTemplate;
                    context: {
                        title: translateKeyPrefix + '.CHANNELS_LINEUP' | translate,
                        tooltip: translateKeyPrefix + '.CHANNEL_LINEUP_TOOLTIP_COPY' | translate,
                        columns: channelLineupRowColumnsData
                    }
                "
            ></ng-container>
        </div>
    </sxm-ui-accordion-chevron>
</div>

<ng-template #gridRowTemplate let-title="title" let-columns="columns" let-subTitle="subTitle">
    <div class="grid-title-row">
        <span class="title" [innerHtml]="title">{{ title }}</span>
        <span class="sub-title" *ngIf="subTitle">{{ subTitle }}</span>
    </div>
    <ng-container *ngFor="let col of columns; let i = index">
        <ng-container *ngIf="col.label !== null && col.label !== undefined; else showCheckmark">
            <div class="col" data-e2e="gridRowColumnFeatureLabel" [class.selected]="i === selectedIndex">
                <ng-container *ngIf="col.linkUrl; else staticLabel">
                    <a class="text-link" [href]="col.linkUrl" target="_blank">{{ col.label }}</a>
                </ng-container>
                <ng-template #staticLabel>
                    <p [innerHTML]="col.label" class="feature-p-el"></p>
                </ng-template>
            </div>
        </ng-container>
        <ng-template #showCheckmark>
            <div data-e2e="gridRowColumnFeatureMark" [class.selected]="i === selectedIndex" class="chevron-checkmark">
                <svg *ngIf="col.checkmark === true" class="icon icon-utility check-mark">
                    <use class="icon-check-mark-flex-stroke" xlink:href="#icon-check-mark-flex-stroke"></use>
                </svg>
                <svg *ngIf="col.checkmark !== true" class="icon icon-utility x-mark">
                    <use class="icon-x-mark-flex-stroke" xlink:href="#icon-x-mark-flex-stroke"></use>
                </svg>
            </div>
        </ng-template>
    </ng-container>
    <hr />
</ng-template>

<ng-template #additionalGridRowsTemplate let-params="datos">
    <ng-container *ngFor="let additionalGridRow of additionalGridRows">
        <ng-container
            *ngTemplateOutlet="
                gridRowTemplate;
                context: { title: additionalGridRow.title, tooltip: additionalGridRow.tooltip, tooltipId: additionalGridRow.tooltipId, columns: additionalGridRow.columns }
            "
        ></ng-container>
    </ng-container>
</ng-template>
