<form [formGroup]="editUsernamePasswordForm" (submit)="handleSubmission($event)">
    <fieldset>
        <legend>{{ translateKeyPrefix + ".EDIT_ACCOUNT_LEGEND" | translate }}</legend>
        <section>
            <div class="server-error">
                <p *ngIf="showServerError">
                    {{ translateKeyPrefix + ".ERRORS.SYSTEM_ERROR" | translate }}
                </p>
                <p
                    *ngIf="
                        editUsernamePasswordForm.value.password !== null &&
                        editUsernamePasswordForm.value.oldPassword !== null &&
                        editUsernamePasswordForm.value.password === editUsernamePasswordForm.value.oldPassword
                    "
                >
                    {{ translateKeyPrefix + ".SAME_PASSWORD_ERROR" | translate }}
                </p>
            </div>
            <h6 class="username">{{ translateKeyPrefix + ".USERNAME_TITLE" | translate }}</h6>
            <p class="username-instruction">{{ translateKeyPrefix + ".USERNAME_INSTRUCTIONS" | translate }}</p>
            <sxm-ui-username-form-field [labelText]="translateKeyPrefix + '.USERNAME_FIELD_LABEL' | translate" formControlName="username"> </sxm-ui-username-form-field>
            <h6 class="password">{{ translateKeyPrefix + ".PASSWORD_TITLE" | translate }}</h6>
            <sxm-ui-password-form-field
                class="mb-16"
                [labelText]="translateKeyPrefix + '.PASSWORD_FIELD_CURRENT_LABEL' | translate"
                formControlName="oldPassword"
            ></sxm-ui-password-form-field>
            <sxm-ui-password-strength
                class="mb-16"
                [class.invalid]="editUsernamePasswordForm.controls.password | formControlInvalid: submitted"
                formControlName="password"
                [id]="newPasswordFieldId"
                [labelText]="translateKeyPrefix + '.PASSWORD_FIELD_NEW_LABEL' | translate"
                [reservedWords]="reservedWords"
                [alwaysDisplayPasswordHint]="alwaysDisplayPasswordHint"
            >
            </sxm-ui-password-strength>
            <div *ngIf="editUsernamePasswordForm.controls.password | formControlInvalid: submitted" class="invalid-feedback">
                <p *ngIf="editUsernamePasswordForm.controls.password.hasError('required')">
                    {{ translateKeyPrefix + ".ERRORS.REQUIRED" | translate }}
                </p>
                <p *ngIf="editUsernamePasswordForm.controls.password.hasError('length')">
                    {{ translateKeyPrefix + ".ERRORS.LENGTH" | translate: editUsernamePasswordForm.controls.password.errors.length }}
                </p>
                <p *ngIf="editUsernamePasswordForm.controls.password.hasError('policy')">
                    {{ translateKeyPrefix + ".ERRORS.POLICY" | translate }}
                </p>
                <p *ngIf="editUsernamePasswordForm.controls.password.hasError('generic')">
                    {{ translateKeyPrefix + ".ERRORS.GENERIC" | translate }}
                </p>
                <p *ngIf="editUsernamePasswordForm.controls.password.errors?.reservedWords as reservedWordsError">
                    {{
                        translateKeyPrefix + ".ERRORS.RESERVED_WORDS"
                            | translate
                                : {
                                      pluralWord: reservedWordsError.words.length | i18nPlural: (translateKeyPrefix + ".PLURAL_MAP.WORD" | translate),
                                      reservedWords: reservedWordsError.words.join(", ")
                                  }
                    }}
                </p>
            </div>
        </section>
        <button
            class="button primary full-width"
            type="submit"
            sxm-proceed-button
            [loading]="processing$ | async"
            [attr.aria-label]="translateKeyPrefix + '.SAVE_BUTTON' | translate"
            sxmUiDataClickTrack="ui"
            data-link-key="EditLoginForm"
            data-test="saveEditLoginForm"
        >
            {{ translateKeyPrefix + ".SAVE_BUTTON" | translate }}
        </button>
        <button
            class="full-width cancel-cta"
            (click)="onCancel()"
            sxmUiDataClickTrack="ui"
            [attr.aria-label]="translateKeyPrefix + '.CANCEL_BUTTON' | translate"
            data-link-key="EditLoginForm"
            data-test="cancelEditLoginForm"
        >
            {{ translateKeyPrefix + ".CANCEL_BUTTON" | translate }}
        </button>
    </fieldset>
</form>
