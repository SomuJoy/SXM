<section id="mainContent" *ngrxLet="organicCredentialsViewModel$ as organicCredentialsViewModel">
    <sxm-ui-step-header>
        <ng-container title>{{ translateKeyPrefix + ".TITLE" | translate }}</ng-container>
    </sxm-ui-step-header>
    <sxm-ui-plan-recap-card
        *ngIf="organicCredentialsViewModel?.planRecapCardViewModel; else skeletonLoaderPlanRecap"
        [data]="organicCredentialsViewModel.planRecapCardViewModel"
    >
    </sxm-ui-plan-recap-card>
    <ng-template #skeletonLoaderPlanRecap>
        <sxm-ui-skeleton-loader-panel id="skeletonLoaderPlanRecap"></sxm-ui-skeleton-loader-panel>
    </ng-template>
    <form [formGroup]="accountLookupForm" sxmUiForceUpdateFormFieldOnEnterKey (ngSubmit)="doAccountLookup()">
        <div *ngIf="accountLookupFormSystemError" class="invalid-feedback">
            <p>{{ translateKeyPrefix + ".SYSTEM_ERROR" | translate }}</p>
        </div>
        <section>
            <sxm-ui-email-form-field
                formControlName="email"
                [errorMsg]="
                    translateKeyPrefix + '.' + (accountLookupForm.controls.email.hasError('usernameInUse') ? 'EMAIL_IN_USE_ERROR_MSG' : 'EMAIL_INVALID_MSG') | translate
                "
            ></sxm-ui-email-form-field>
            <sxm-ui-password-form-field formControlName="password"></sxm-ui-password-form-field>
            <sxm-ui-password-requirements-copy></sxm-ui-password-requirements-copy>
        </section>
        <privacy-policy></privacy-policy>
        <button type="submit" data-test="submit-credentials" sxm-proceed-button [loading]="accountLookupProcessing$ | async" sxmUiDataClickTrack="submit">
            {{ translateKeyPrefix + ".CONTINUE_BUTTON_TEXT" | translate }}
        </button>
    </form>
    <sxm-ui-modal
        #subscriptionWithStreamingFoundModal
        id="streamingFoundModal"
        [titlePresent]="true"
        [title]="translateKeyPrefix + '.SUBSCRIPTIONS_FOUND_MODAL_TITLE' | translate"
        [ariaDescribedbyTextId]="subscriptionFoundModalAriaDescribedbyTextId"
        (modalClosed)="trackComponentImpression('accountlookupvar2')"
    >
        <section id="streamingFoundModalContent">
            <h2 id="streamingFoundModalBodyTitle">{{ translateKeyPrefix + ".SUBSCRIPTIONS_FOUND_MODAL_HEADLINE" | translate }}</h2>
            <article *ngIf="organicCredentialsViewModel?.activeStreamingSubscriptionViewModel as activeSubscriptionViewModel">
                <ng-container *ngIf="activeSubscriptionViewModel.streaming.length > 0">
                    <h3>{{ translateKeyPrefix + ".CUSTOMER_HAS_STREAMING.SUB_TITLE" | translate }}</h3>
                    <p [id]="subscriptionFoundModalAriaDescribedbyTextId">{{ translateKeyPrefix + ".CUSTOMER_HAS_STREAMING.INSTRUCTIONS" | translate }}</p>
                    <article *ngFor="let subscription of activeSubscriptionViewModel.streaming">
                        <div>
                            <p>
                                <strong>{{ subscription.maskedEmail }}</strong>
                            </p>
                            <p>{{ subscription.planName }}</p>
                        </div>
                        <aside>
                            <streaming-player-link
                                [customLink]="translateKeyPrefix + '.STREAMING_PLAYER_LINK' | translate"
                                [customLinkText]="translateKeyPrefix + '.CUSTOMER_HAS_STREAMING.CTA_LINK_TEXT' | translate"
                                [customLinkClasses]="['player-link', 'no-underline']"
                                [useCurrentWindow]="false"
                            >
                            </streaming-player-link>
                        </aside>
                    </article>
                </ng-container>
                <ng-container *ngIf="activeSubscriptionViewModel.trials.length > 0">
                    <h3>{{ translateKeyPrefix + ".CUSTOMER_HAS_TRIAL.SUB_TITLE" | translate }}</h3>
                    <p [id]="subscriptionFoundModalAriaDescribedbyTextId">{{ translateKeyPrefix + ".CUSTOMER_HAS_TRIAL.INSTRUCTIONS" | translate }}</p>
                    <article *ngFor="let subscription of activeSubscriptionViewModel.trials">
                        <div>
                            <p>
                                <strong>{{ subscription.maskedEmail }}</strong>
                            </p>
                            <p>{{ subscription.planName }}</p>
                        </div>
                        <aside>
                            <a (click)="onSubscribe(subscription.id)" sxmUiDataClickTrack="routing" class="subscribe-link no-underline">
                                {{ translateKeyPrefix + ".CUSTOMER_HAS_TRIAL.CTA_LINK_TEXT" | translate }}
                            </a>
                        </aside>
                    </article>
                </ng-container>
            </article>
        </section>
    </sxm-ui-modal>

    <sxm-ui-modal #lpzModal [title]="translateKeyPrefix + '.VERIFY' | translate" [titlePresent]="true" [ariaDescribedbyTextId]="lpzModalAriaDescribedbyTextId">
        <h5 class="verify-your-account">{{ translateKeyPrefix + ".ACCOUNT_VERIFY" | translate }}</h5>
        <p [id]="lpzModalAriaDescribedbyTextId" class="verify-paragraph">{{ translateKeyPrefix + ".VERIFY_PARAGRAPH" | translate }}</p>
        <identification-validate-lpz-form [displayPrivacyPolicy]="true" #lpzFormComponent (lpzValidated)="lpzValidated($event)"></identification-validate-lpz-form>
    </sxm-ui-modal>

    <sxm-ui-loading-with-alert-message
        *ngIf="displayIneligibleLoader$ | async"
        [isLoading]="true"
        [pillMessage]="translateKeyPrefix + '.INELIGIBLE_LOADING_ALERT' | translate"
        [paragraph]="translateKeyPrefix + '.INELIGIBLE_LOADING_BODY' | translate"
        (loadingCompleted)="onLoadingWithAlertMessageComplete($event)"
    ></sxm-ui-loading-with-alert-message>
</section>
