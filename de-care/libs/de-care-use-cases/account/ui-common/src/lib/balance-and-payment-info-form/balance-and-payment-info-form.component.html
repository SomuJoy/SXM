<section id="mainContent">
    <section class="section--balance" *ngIf="!isUpdatePaymentMethodOnly">
        <sxm-ui-balance-info [withoutFees]="withoutFees" [canSelectPaymentFrequency]="canSelectPaymentFrequency" [balanceDataValues]="balanceDataValues"></sxm-ui-balance-info>
    </section>
    <form [formGroup]="paymentForm" class="section--payment-form">
        <section *ngIf="canSelectAmountToPay && !isUpdatePaymentMethodOnly" data-test="PaymentAmountRadioButtonsSection">
            <header>
                <h3 class="radio-buttons-title">{{ translateKeyPrefix + ".PAYMENT_AMOUNT.TITLE" | translate }}</h3>
            </header>
            <div *ngIf="amountOptionIsInvalid" class="invalid-feedback" id="paymentAmountOptionError">
                <p>{{ translateKeyPrefix + ".PAYMENT_AMOUNT.ERROR" | translate }}</p>
            </div>
            <sxm-ui-radio-option-form-field
                class="label-bold description-inline"
                formControlName="paymentAmountOption"
                [label]="balanceDataValues.totalAmountDue | currency: 'USD':'symbol-narrow':undefined:(currentLang$ | async)"
                [description]="translateKeyPrefix + '.PAYMENT_AMOUNT.OPTION_PAY_ALL' | translate"
                [value]="balanceDataValues.totalAmountDue"
            ></sxm-ui-radio-option-form-field>
            <sxm-ui-radio-option-form-field
                class="label-bold description-inline"
                formControlName="paymentAmountOption"
                [label]="balanceDataValues.currentBalanceDue | currency: 'USD':'symbol-narrow':undefined:(currentLang$ | async)"
                [description]="translateKeyPrefix + '.PAYMENT_AMOUNT.OPTION_PAY_CURRENT_BALANCE' | translate"
                [value]="balanceDataValues.currentBalanceDue"
            ></sxm-ui-radio-option-form-field>
        </section>

        <section class="billing-field-set">
            <header>
                <h3>{{ translateKeyPrefix + ".BILLING_DETAILS_TITLE" | translate }}</h3>
            </header>
            <sxm-ui-address-form-fields
                addressType="service"
                formControlName="serviceAddress"
                [submitted]="paymentFormSubmitted"
                data-e2e="BillingInfoAddress"
            ></sxm-ui-address-form-fields>
        </section>

        <section class="billing-field-set credit-card-fields" id="creditCardFieldsSection" #creditCardFieldsSection>
            <header>
                <h3>{{ translateKeyPrefix + ".PAYMENT_DETAILS_TITLE" | translate }}</h3>
                <ul class="credit-card-icons-list">
                    <li *ngFor="let cardType of translateKeyPrefix + '.CARD_TYPE_ICONS' | translate">
                        <svg class="icon icon-content cc-icon icon-{{ cardType }}">
                            <use class="" [attr.xlink:href]="'#icon-cc-' + cardType"></use>
                        </svg>
                    </li>
                </ul>
            </header>
            <div *ngIf="creditCardSubmissionError$ | async" class="invalid-feedback" id="creditCardProcessingError">
                <p>{{ translateKeyPrefix + ".CREDIT_CARD_PROCESSING_ERROR" | translate }}</p>
            </div>
            <div *ngIf="unexpectedSubmissionError$ | async" class="invalid-feedback" id="unexpectedProcessingError">
                <p>{{ translateKeyPrefix + ".UNEXPECTED_ERROR" | translate }}</p>
            </div>
            <sxm-ui-credit-card-form-fields [formGroup]="paymentForm.controls.creditCardInfo"></sxm-ui-credit-card-form-fields>
            <privacy-policy></privacy-policy>
        </section>
        <section *ngIf="canSelectPaymentFrequency" data-test="PaymentFrequencyRadioButtonsSection">
            <header>
                <h3 class="radio-buttons-title">{{ translateKeyPrefix + ".PAYMENT_FREQUENCY.TITLE" | translate }}</h3>
            </header>
            <div *ngIf="frequencyOptionIsInvalid" class="invalid-feedback" id="paymentFrequencyOptionError">
                <p>{{ translateKeyPrefix + ".PAYMENT_FREQUENCY.ERROR" | translate }}</p>
            </div>
            <sxm-ui-radio-option-form-field
                formControlName="paymentFrequencyOption"
                [label]="translateKeyPrefix + '.PAYMENT_FREQUENCY.OPTION_RECURRING' | translate"
                [value]="recurring"
            ></sxm-ui-radio-option-form-field>
            <sxm-ui-radio-option-form-field
                formControlName="paymentFrequencyOption"
                [label]="translateKeyPrefix + '.PAYMENT_FREQUENCY.OPTION_ONE_TIME' | translate"
                [value]="oneTime"
            ></sxm-ui-radio-option-form-field>
        </section>
        <section>
            <sxm-ui-charge-agreement-generic-checkbox-form-field
                [paymentFrequency]="paymentFrequency$ | async"
                [useRateVersionOfTextCopy]="withoutFees"
                formControlName="chargeAgreementAccepted"
            ></sxm-ui-charge-agreement-generic-checkbox-form-field>
        </section>
        <button
            type="submit"
            sxm-proceed-button
            [loading]="paymentFormProcessing$ | async"
            sxmUiDataClickTrack="submit"
            (click)="submitPaymentInfo()"
            data-test="SubmitPaymentButton"
        >
            {{ translateKeyPrefix + (isUpdatePaymentMethodOnly ? ".UPDATE_PAYMENT_BUTTON" : ".SUBMIT_PAYMENT_BUTTON_TEXT") | translate }}
        </button>
    </form>
</section>
<sxm-ui-modal [closed]="true" (modalClosed)="onEditExistingAddress()" #verifyAddressModal  [ariaDescribedbyTextId]="balancePaymentModalAriaDescribedbyTextId">
    <customer-verify-address
        [ariaDescribedbyTextId]="balancePaymentModalAriaDescribedbyTextId"
        [data]="verifyAddressesDataViewModel$ | async"
        (editAddress)="onUseAddressFromValidation($event)"
        (editExisting)="onEditExistingAddress()"
    ></customer-verify-address>
</sxm-ui-modal>
